# Phase 1: CLI TUI MVP Implementation Plan

## Overview
This document outlines the actionable implementation plan for Phase 1 of the folder-mcp CLI TUI MVP, based on the initiation flow diagram and development requirements.

## TUI Flow Tree Visualization

```
┌─────────────────────────────────────────────────────────────────┐
│                         Launch Application                      │
└─────────────────┬───────────────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Initialize TUI Framework                     │
│  • Full-screen terminal interface                               │
│  • Keyboard event handling                                      │
│  • Screen management                                            │
└─────────────────┬───────────────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Check Cached Config                         │
│  • Look for .folder-mcp configuration                          │
└─────────────────┬───────────────────────────────────────────────┘
                  │
        ┌─────────┴─────────┐
        │ Cached Config?    │
        └─────┬─────────────┘
     Yes ─────┤───── No
              │
    ┌─────────▼──────────┐              ┌──────────────────────────┐
    │  Load from Cache   │              │   System Auto-Detection  │
    │  • Read .folder-mcp│              │  • Detect available models│
    │  • Validate config │              │  • Calculate defaults     │
    └─────────┬──────────┘              └─────────┬────────────────┘
              │                                   │
              └─────────┬─────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────────────┐
│                    User Configuration Choice                    │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │  TUI Dialog with Options:                                   ││
│  │  [ ] Configure what's best for my computer (Auto)          ││
│  │  [ ] Open configuration wizard (Manual)                    ││
│  │                                                             ││
│  │  Navigation: ↑↓ Arrow keys, Enter to select               ││
│  └─────────────────────────────────────────────────────────────┘│
└─────────────────┬───────────────────────────────────────────────┘
                  │
        ┌─────────┴─────────┐
        │ User Choice?      │
        └─────┬─────────────┘
     Auto ────┤───── Manual
              │
    ┌─────────▼──────────┐              ┌──────────────────────────┐
    │   Skip Wizard      │              │  Configuration Wizard    │
    │   • Multi-language │              │  ┌─────────────────────┐ │
    │     defaults       │              │  │ Content Description │ │
    └─────────┬──────────┘              │  │ • Tell me about     │ │
              │                         │  │   folder content    │ │
              │                         │  │ • Single/Multi lang │ │
              │                         │  └─────────────────────┘ │
              │                         │  ┌─────────────────────┐ │
              │                         │  │ Model Selection     │ │
              │                         │  │ • Multi-lang models │ │
              │                         │  │ • Single-lang (big) │ │
              │                         │  │ • Performance info  │ │
              │                         │  └─────────────────────┘ │
              │                         │  ┌─────────────────────┐ │
              │                         │  │ Port Configuration  │ │
              │                         │  │ • Default: 3000     │ │
              │                         │  │ • Custom input      │ │
              │                         │  └─────────────────────┘ │
              │                         └─────────┬────────────────┘
              │                                   │
              └─────────┬─────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Parse CLI Parameters                         │
│  • Override config with command-line arguments                  │
│  • Validate parameter combinations                              │
└─────────────────┬───────────────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────────────┐
│                 Runtime Configuration Check                     │
│  • Compare current config with cached version                   │
│  • Determine if embeddings need regeneration                    │
└─────────────────┬───────────────────────────────────────────────┘
                  │
        ┌─────────┴─────────┐
        │ Config Changed?   │
        └─────┬─────────────┘
     Yes ─────┤───── No
              │
    ┌─────────▼──────────┐              ┌──────────────────────────┐
    │ Update Embeddings  │              │ Check Embedding Status   │
    │ Storage            │              │ • Verify completeness    │
    └─────────┬──────────┘              └─────────┬────────────────┘
              │                                   │
              └─────────┬─────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Progress Notification Area                   │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │ Server Status: [████████░░] 80% Indexing files...          ││
│  │                                                             ││
│  │ Current: Processing document 45/67                         ││
│  │ Embeddings: [██████████] Complete                          ││
│  │                                                             ││
│  │ Press 'h' for help, 'q' to quit                           ││
│  └─────────────────────────────────────────────────────────────┘│
└─────────────────┬───────────────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────────────┐
│                      MCP Server Ready                          │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │ 🟢 folder-mcp Server Running                               ││
│  │                                                             ││
│  │ Port: 3000                                                  ││
│  │ Model: nomic-embed-text                                     ││
│  │ Documents: 67 indexed                                       ││
│  │                                                             ││
│  │ ┌─────────────────────────────────────────────────────────┐ ││
│  │ │ Command Input:                                          │ ││
│  │ │ > \help                                                 │ ││
│  │ │                                                         │ ││
│  │ │ Available Commands:                                     │ ││
│  │ │ \model - Select embedding model                         │ ││
│  │ │ \port - Change server port                              │ ││
│  │ │ \status - Show server status                            │ ││
│  │ │ \config - Show configuration                            │ ││
│  │ │ \connection - Get MCP connection JSON                   │ ││
│  │ └─────────────────────────────────────────────────────────┘ ││
│  └─────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────┘
```

## Linear Implementation Plan (Following Flow Chart)

### Step 1: Launch Application
**Goal: Get the TUI framework running with initial setup**

**User Conversation:**
- User launches the application
- System initializes TUI framework and displays branding/splash screen
- Basic component architecture is established

**Step Tasks:**
- [ ] Create main TUI entry point (`src/interfaces/tui/TUIApplication.tsx`)
- [ ] Initialize Ink app with React components
- [ ] Set up basic component-based architecture with hooks
- [ ] Create initial launch screen component with branding
- [ ] **Design System Foundation:**
  - [ ] Create `src/interfaces/tui/design/colors.ts` with color palette
  - [ ] Create `src/interfaces/tui/design/typography.ts` with text styles
  - [ ] Create `src/interfaces/tui/design/animations.ts` with easing functions

### Step 2: Initialize TUI Framework
**Goal: Core TUI infrastructure with keyboard handling**

**User Conversation:**
- System sets up keyboard navigation and screen management
- User can now interact with the interface using keyboard
- Smooth transitions and animations are ready for use

**Step Tasks:**
- [ ] Create `src/interfaces/tui/hooks/useKeyboard.ts` for keyboard handling
- [ ] Implement screen routing system with React state management
- [ ] Create `src/interfaces/tui/hooks/useAnimation.ts` for smooth transitions
- [ ] **Advanced Keyboard Handling:**
  - [ ] Focus management with React refs and useEffect
  - [ ] Tab/shift-tab navigation with React focus trap
  - [ ] Arrow key navigation with smooth state transitions

### Step 3: Check Cached Config
**Goal: Configuration detection and loading**

**User Conversation:**
- System checks for existing configuration in .folder-mcp file
- User sees loading indicator while config is being validated
- If config exists, user sees "Loading previous configuration..." message
- If no config, user proceeds to configuration choice

**Step Tasks:**
- [ ] Implement .folder-mcp config file detection
- [ ] Create config validation logic
- [ ] Build config loading with error handling
- [ ] Add visual feedback for config status

### Step 4: User Configuration Choice
**Goal: Auto vs Manual configuration decision**

**User Conversation:**
- User is presented with two options:
  - "Configure what's best for my computer (Auto)" - with animated bullets
  - "Open configuration wizard (Manual)"
- User navigates with arrow keys, sees smooth focus transitions
- User presses Enter to make selection
- System provides immediate visual feedback and routes to chosen path

**Step Tasks:**
- [ ] Create `src/interfaces/tui/components/ConfigurationChoice.tsx`
- [ ] **Interactive Feedback:**
  - [ ] Use Ink's `<Box>` and `<Text>` with color state changes
  - [ ] Focus indicators with useState and conditional styling
  - [ ] Create `src/interfaces/tui/components/AnimatedBullets.tsx` (Claude Code style)
- [ ] Implement auto-configuration path with React state
- [ ] Route to configuration wizard using screen state management

### Step 5: Configuration Wizard
**Goal: Complete manual configuration flow**

**User Conversation:**
- User enters content description: "Tell me about the content in this folder"
- User selects single language or multi-language support
- System detects hardware capabilities and shows available models
- User browses model list with performance info and recommendations
- User selects embedding model based on their needs (larger models for single-language)
- User configures server port (default 3000) with validation
- User confirms final configuration

**Step Tasks:**
- [ ] **Content Description Input:**
  - [ ] Create `src/interfaces/tui/components/CommandInput.tsx` with Ink's `<TextInput>`
  - [ ] Use `<Box>` with borders and React state for validation
  - [ ] Language selection with `useState` and conditional rendering
- [ ] **System Detection & Model Selection:**
  - [ ] Create `src/interfaces/tui/services/SystemCapabilities.ts` for hardware detection
  - [ ] Create `src/interfaces/tui/services/HuggingFaceMetadata.ts` for model data
  - [ ] Create `src/interfaces/tui/services/OllamaIntegration.ts` for Ollama CLI
  - [ ] Create `src/interfaces/tui/components/ModelSelection.tsx` with scrollable list
  - [ ] **BitNet support for very weak machines**
  - [ ] Model selection with React state and conditional model filtering
  - [ ] Performance info display using Ink's layout components
- [ ] **Port Configuration:**
  - [ ] Port input with `<TextInput>` and validation hooks
  - [ ] Port conflict detection with async validation

### Step 6: Parse CLI Parameters
**Goal: Override configuration with command-line arguments**

**User Conversation:**
- System processes command-line arguments provided at launch
- User sees "Applying command-line overrides..." message
- Any conflicting parameters are resolved with CLI taking precedence
- User sees final configuration summary before proceeding
- System validates all parameter combinations

**Step Tasks:**
- [ ] Parse command-line arguments
- [ ] Override wizard/auto configuration
- [ ] Validate parameter combinations
- [ ] Display final configuration summary

### Step 7: Runtime Configuration Check
**Goal: Determine if embeddings need regeneration**

**User Conversation:**
- System compares current configuration with cached version
- User sees "Checking configuration changes..." spinner
- If config changed: "Configuration updated, regenerating embeddings..."
- If config unchanged: "Configuration unchanged, verifying embeddings..."
- User sees the decision and reasoning before proceeding

**Step Tasks:**
- [ ] Compare current config with cached version
- [ ] Detect configuration changes
- [ ] Determine embedding regeneration needs
- [ ] Route to appropriate embedding process

### Step 8: Embedding Management
**Goal: Update or verify embeddings with progress tracking**

**User Conversation:**
- If model needs download: "Downloading [model-name]..." with progress bar
- User sees GPU/CPU status: "Using GPU acceleration" or "Using CPU (slower)"
- During embedding generation: "Processing documents [32/156] - Batch 4/5"
- FAISS index building: "Building vector index..." with spinner
- User sees estimated time remaining and current operation
- Success: "Embeddings ready! Processed X documents"

**Step Tasks:**
- [ ] **Embedding Model Setup:**
  - [ ] Create `src/interfaces/tui/services/ModelDownloader.ts` with progress hooks
  - [ ] **Model download progress with React state and useEffect**
  - [ ] **GPU/CPU status using `src/interfaces/tui/components/StatusDisplay.tsx`**
- [ ] **Progress & Notification System:**
  - [ ] Create `src/interfaces/tui/hooks/useProgress.ts` for embedding progress
  - [ ] **FAISS vector index progress with React state updates**
  - [ ] Create `src/interfaces/tui/components/LoadingSpinner.tsx` with animations
  - [ ] Progress bars using Ink's layout and useState for smooth updates
- [ ] **Integration Points:**
  - [ ] Connect MCP server initialization with React context
  - [ ] Embedding system integration with async React patterns
  - [ ] File watching integration with useEffect cleanup

### Step 9: Progress Notification Area
**Goal: Real-time progress display with animations**

**User Conversation:**
- User sees comprehensive progress dashboard with multiple progress bars
- Real-time updates: "Server Status: [████████░░] 80% Indexing files..."
- Current operation: "Processing document 45/67"
- Server state transitions: "Starting server..." → "Ready"
- User can press 'h' for help, 'q' to quit during this phase
- Smooth animations keep user engaged during long operations

**Step Tasks:**
- [ ] Real-time progress bars
- [ ] Server state notifications with smooth transitions
- [ ] **Animation & Transitions:**
  - [ ] Fade in/out transitions for content changes
  - [ ] Contextual help tooltips that appear/disappear gracefully
- [ ] Error handling and display
- [ ] Success confirmations

### Step 10: MCP Server Ready
**Goal: Final interface with command system**

**User Conversation:**
- User sees: "🟢 folder-mcp Server Running" with server details
- Display shows: "Port: 3000, Model: nomic-embed-text, Documents: 67 indexed"
- User can type commands in input box: "> \help"
- Available slash commands displayed with descriptions
- User can invoke \model, \port, \status, \config, \connection, \help
- Interactive help system guides user through available commands
- User can now use the fully functional MCP server interface

**Step Tasks:**
- [ ] Create `src/interfaces/tui/screens/MainScreen.tsx` with server ready state
- [ ] **Command Input System:**
  - [ ] Enhance `CommandInput.tsx` with focus animations using React state
  - [ ] Create `src/interfaces/tui/navigation/SlashCommands.ts` parser
  - [ ] Build autocomplete with React state and filtered suggestions
- [ ] **Slash Commands Implementation:**
  - [ ] `\model` - Modal dialog using conditional rendering
  - [ ] `\port` - Port config modal with `<TextInput>`
  - [ ] `\status` - Status overlay using React state
  - [ ] `\config` - Config viewer with scrollable `<Box>`
  - [ ] `\connection` - JSON display with copy functionality
  - [ ] `\help` - Help modal using conditional rendering
- [ ] **Advanced Help System:**
  - [ ] Create `src/interfaces/tui/components/HelpSystem.tsx`
  - [ ] Connection JSON generation with React state
  - [ ] Keyboard shortcuts overlay with animations
- [ ] **Final Polish:**
  - [ ] Optimize React renders with useMemo and useCallback
  - [ ] Responsive layout using Ink's flexbox and terminal size hooks
  - [ ] Performance optimization with React.memo for heavy components

## Technical Architecture

### TUI Components Structure (Ink + React)
```
src/interfaces/tui/
├── components/                    # **React components for Ink**
│   ├── ConfigurationWizard.tsx    # **React component with hooks**
│   ├── ProgressNotification.tsx   # **Animated progress bars**
│   ├── CommandInput.tsx           # **Input with focus animations**
│   ├── StatusDisplay.tsx          # **Real-time status updates**
│   ├── ModelSelection.tsx         # **NEW: Model browsing with metadata**
│   ├── SystemDetection.tsx        # **NEW: CPU/GPU/RAM detection**
│   ├── AnimatedBullets.tsx        # **NEW: Claude Code-style bullets**
│   ├── LoadingSpinner.tsx         # **NEW: Smooth loading animations**
│   └── HelpSystem.tsx
├── screens/                       # **Full-screen React components**
│   ├── WelcomeScreen.tsx
│   ├── ConfigScreen.tsx
│   ├── MainScreen.tsx
│   └── ErrorScreen.tsx
├── hooks/                         # **NEW: Custom React hooks**
│   ├── useKeyboard.ts             # **Advanced keyboard handling**
│   ├── useAnimation.ts            # **Animation utilities**
│   ├── useTheme.ts                # **Color scheme management**
│   └── useProgress.ts             # **Progress tracking**
├── design/                        # **NEW: Design system**
│   ├── colors.ts                  # **Color palette definition**
│   ├── typography.ts              # **Text styles and spacing**
│   ├── animations.ts              # **Easing functions and timing**
│   └── theme.ts                   # **Overall design tokens**
├── navigation/
│   ├── KeyboardHandler.ts
│   ├── SlashCommands.ts
│   └── NavigationManager.ts
├── services/                      # **Backend integration services**
│   ├── HuggingFaceMetadata.ts     # **Model metadata from HF Hub**
│   ├── OllamaIntegration.ts       # **Ollama CLI management**
│   ├── SystemCapabilities.ts     # **Hardware detection**
│   └── ModelDownloader.ts         # **Download progress tracking**
└── TUIApplication.tsx             # **Main Ink app component**
```

### State Management
- Application state using reactive patterns
- Configuration state synchronization
- Progress tracking and updates
- Command history and context

### Error Handling
- Graceful degradation for missing features
- User-friendly error messages
- Recovery suggestions
- Fallback to CLI mode if TUI fails

## Testing Strategy
- Unit tests for each TUI component
- Integration tests for user flows
- Manual testing for keyboard navigation
- Accessibility testing for screen readers

## TUI Library Recommendation

**Recommended: Ink + React**

**Why Ink?**
- React-based components for familiar development patterns
- Excellent animation support through hooks and state management
- Built-in keyboard navigation and focus management
- Active community and great documentation
- Perfect for achieving Claude Code-level polish

**Alternative: Blessed** (if you prefer lower-level control)
- More manual but gives fine-grained control over animations
- Better performance for very complex UIs
- Steeper learning curve

**Installation:**
```bash
npm install ink react
npm install --save-dev @types/react
```

**✅ SELECTED: Ink + React** - Chosen for Claude Code-level polish and animation capabilities

## Success Criteria
- ✅ Full-screen TUI launches successfully **with smooth animations**
- ✅ Configuration wizard guides user through setup **with Claude Code-level polish**
- ✅ **System auto-detection works on target platforms (CPU/GPU/RAM)**
- ✅ **Model selection shows HuggingFace metadata and recommendations**
- ✅ **Ollama integration for model management**
- ✅ **BitNet support for weak machines**
- ✅ Slash commands provide full CLI functionality **with visual feedback**
- ✅ Progress bars show real-time status **with smooth animations including model downloads and embedding generation**
- ✅ MCP server integrates seamlessly
- ✅ Keyboard navigation is intuitive and complete **with focus animations**
- ✅ **UI feels as polished and responsive as Claude Code interface**